<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/Event.h">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/Event.h" />
              <option name="originalContent" value="#pragma once&#10;#include&quot;SSDBType.h&quot;&#10;#include&lt;chrono&gt;&#10;#include&lt;string&gt;&#10;#include &lt;cereal/cereal.hpp&gt;&#10;#include &lt;cereal/types/string.hpp&gt;&#10;&#10;namespace SSDB&#10;{&#10;    class Event&#10;    {&#10;    private:&#10;        std::chrono::time_point&lt;std::chrono::system_clock&gt; event_time;&#10;        int id; //事件本身的 ID&#10;        EventType event_type;&#10;        int operating_object; //事件操作的对象的 ID&#10;        std::string reason;&#10;        int operate_person; //操作者&#10;        int delta_score; //分数变动情况&#10;        bool erased = false;&#10;&#10;    public:&#10;        // 构造函数&#10;        Event(int _id,&#10;              EventType _type,&#10;              int _operating_object,&#10;              const std::string&amp; _reason,&#10;              int _operate_person,&#10;              int _delta_score,&#10;              std::chrono::time_point&lt;std::chrono::system_clock&gt; _time = std::chrono::system_clock::now())&#10;            : event_time(_time), id(_id), event_type(_type), operating_object(_operating_object), reason(_reason),&#10;              operate_person(_operate_person), delta_score(_delta_score)&#10;        {&#10;        }&#10;&#10;        // 默认构造函数&#10;        Event() : event_time(std::chrono::system_clock::now()), id(0), event_type(EventType::STUDENT),&#10;                  operating_object(0), operate_person(0), delta_score(0)&#10;        {&#10;        }&#10;&#10;        // Getters&#10;        std::chrono::time_point&lt;std::chrono::system_clock&gt; GetEventTime() const { return event_time; }&#10;        int GetId() const { return id; }&#10;        EventType GetEventType() const { return event_type; }&#10;        int GetOperatingObject() const { return operating_object; }&#10;        const std::string&amp; GetReason() const { return reason; }&#10;        int GetOperatePerson() const { return operate_person; }&#10;        int GetDeltaScore() const { return delta_score; }&#10;&#10;        // Setters&#10;        void SetEventTime(std::chrono::time_point&lt;std::chrono::system_clock&gt; t) { event_time = t; }&#10;        void SetId(int _id) { id = _id; }&#10;        void SetEventType(EventType t) { event_type = t; }&#10;        void SetOperatingObject(int obj) { operating_object = obj; }&#10;        void SetReason(const std::string&amp; r) { reason = r; }&#10;        void SetOperatePerson(int p) { operate_person = p; }&#10;        void SetDeltaScore(int s) { delta_score = s; }&#10;&#10;        // cereal 序列化&#10;        template &lt;class Archive&gt;&#10;        void serialize(Archive&amp; ar)&#10;        {&#10;            // 将时间点转换为可序列化的整数 (自 epoch 的毫秒)&#10;            auto millis = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(event_time.time_since_epoch()).count();&#10;            ar(CEREAL_NVP(millis),&#10;               CEREAL_NVP(id),&#10;               CEREAL_NVP(event_type),&#10;               CEREAL_NVP(operating_object),&#10;               CEREAL_NVP(reason),&#10;               CEREAL_NVP(operate_person),&#10;               CEREAL_NVP(delta_score));&#10;            // 反序列化后重建 event_time&#10;            if (Archive::is_loading::value)&#10;            {&#10;                event_time = std::chrono::system_clock::time_point(std::chrono::milliseconds(millis));&#10;            }&#10;        }&#10;    };&#10;}&#10;" />
              <option name="updatedContent" value="#pragma once&#10;#include&quot;SSDBType.h&quot;&#10;#include&lt;chrono&gt;&#10;#include&lt;string&gt;&#10;#include &lt;cereal/cereal.hpp&gt;&#10;#include &lt;cereal/types/string.hpp&gt;&#10;&#10;namespace SSDB&#10;{&#10;    class Event&#10;    {&#10;    private:&#10;        std::chrono::time_point&lt;std::chrono::system_clock&gt; event_time;&#10;        int id; //事件本身的 ID&#10;        EventType event_type;&#10;        int operating_object; //事件操作的对象的 ID&#10;        std::string reason;&#10;        int operate_person; //操作者&#10;        int delta_score; //分数变动情况&#10;        bool erased = false;&#10;&#10;    public:&#10;        // 构造函数&#10;        Event(int _id,&#10;              EventType _type,&#10;              int _operating_object,&#10;              const std::string&amp; _reason,&#10;              int _operate_person,&#10;              int _delta_score,&#10;              std::chrono::time_point&lt;std::chrono::system_clock&gt; _time = std::chrono::system_clock::now())&#10;            : event_time(_time), id(_id), event_type(_type), operating_object(_operating_object), reason(_reason),&#10;              operate_person(_operate_person), delta_score(_delta_score)&#10;        {&#10;        }&#10;&#10;        // 默认构造函数&#10;        Event() : event_time(std::chrono::system_clock::now()), id(0), event_type(EventType::STUDENT),&#10;                  operating_object(0), operate_person(0), delta_score(0)&#10;        {&#10;        }&#10;&#10;        // Getters&#10;        std::chrono::time_point&lt;std::chrono::system_clock&gt; GetEventTime() const { return event_time; }&#10;        int GetId() const { return id; }&#10;        EventType GetEventType() const { return event_type; }&#10;        int GetOperatingObject() const { return operating_object; }&#10;        const std::string&amp; GetReason() const { return reason; }&#10;        int GetOperatePerson() const { return operate_person; }&#10;        int GetDeltaScore() const { return delta_score; }&#10;        bool IsErased() const { return erased; }&#10;&#10;        // Setters&#10;        void SetEventTime(std::chrono::time_point&lt;std::chrono::system_clock&gt; t) { event_time = t; }&#10;        void SetId(int _id) { id = _id; }&#10;        void SetEventType(EventType t) { event_type = t; }&#10;        void SetOperatingObject(int obj) { operating_object = obj; }&#10;        void SetReason(const std::string&amp; r) { reason = r; }&#10;        void SetOperatePerson(int p) { operate_person = p; }&#10;        void SetDeltaScore(int s) { delta_score = s; }&#10;        void SetErased(bool e) { erased = e; }&#10;&#10;        // cereal 序列化：使用 save/load 分离实现&#10;        template &lt;class Archive&gt;&#10;        void save(Archive&amp; ar) const&#10;        {&#10;            // 将时间点转换为自 epoch 的毫秒数&#10;            std::int64_t millis = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(event_time.time_since_epoch()).count();&#10;            int et = static_cast&lt;int&gt;(event_type);&#10;            ar(cereal::make_nvp(&quot;millis&quot;, millis),&#10;               cereal::make_nvp(&quot;id&quot;, id),&#10;               cereal::make_nvp(&quot;event_type&quot;, et),&#10;               cereal::make_nvp(&quot;operating_object&quot;, operating_object),&#10;               cereal::make_nvp(&quot;reason&quot;, reason),&#10;               cereal::make_nvp(&quot;operate_person&quot;, operate_person),&#10;               cereal::make_nvp(&quot;delta_score&quot;, delta_score),&#10;               cereal::make_nvp(&quot;erased&quot;, erased));&#10;        }&#10;&#10;        template &lt;class Archive&gt;&#10;        void load(Archive&amp; ar)&#10;        {&#10;            std::int64_t millis = 0;&#10;            int et = 0;&#10;            ar(cereal::make_nvp(&quot;millis&quot;, millis),&#10;               cereal::make_nvp(&quot;id&quot;, id),&#10;               cereal::make_nvp(&quot;event_type&quot;, et),&#10;               cereal::make_nvp(&quot;operating_object&quot;, operating_object),&#10;               cereal::make_nvp(&quot;reason&quot;, reason),&#10;               cereal::make_nvp(&quot;operate_person&quot;, operate_person),&#10;               cereal::make_nvp(&quot;delta_score&quot;, delta_score),&#10;               cereal::make_nvp(&quot;erased&quot;, erased));&#10;            // 反序列化后重建 event_time 和 event_type&#10;            event_time = std::chrono::system_clock::time_point(std::chrono::milliseconds(millis));&#10;            event_type = static_cast&lt;EventType&gt;(et);&#10;        }&#10;    };&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>